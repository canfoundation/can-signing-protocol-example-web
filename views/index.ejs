<!DOCTYPE html>

<html>
  <head>
    <title>Sign transaction sample</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width" />

    <!-- Compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  </head>

  <body>
    <div class="container">
      <br />
      <div class="row">
        <div class="col s12">
          <div class="right-align">
            <% if (!token) { %>
            <button
              class="can-pass-login-button"
              data-redirect-uri="http://localhost:3002/auth/cryptobadge/callback"
              data-state="random string"
              data-domain="https://test.canpass.me"
              data-text="Sign in with can-pass"
            ></button>
            <% } else { %>
            <a href="/logout">Logout</a>
            <% } %>
          </div>
        </div>
      </div>
      <% if (token) { %>
      <div class="row">
        <div class="col m8 offset-m4">
          <table>
            <thead>
              <tr>
                <th>name</th>
                <th>value</th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>access_token</td>
                <td><%= token.access_token %></td>
              </tr>
              <tr>
                <td>token_type</td>
                <td><%= token.token_type %></td>
              </tr>
              <tr>
                <td>expires_in</td>
                <td><%= token.expires_in %></td>
              </tr>
              <tr>
                <td>refresh_token</td>
                <td><%= token.refresh_token %></td>
              </tr>
              <tr>
                <td>scope</td>
                <td><%= token.scope %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <% } %>
    </div>

    <script src="/can-pass-api.js"></script>

    <script>
      (function () {
        const canPass = window.CanPass && window.CanPass.getInstance();

        if (canPass) {
          canPass.init({
            clientId: '514744fe2356ecd585789ebddfecb087',
            version: '1.0',
            endPoint: 'https://pro.api.cryptobadge.app/can-keys-dev/graphql',
            signTxURL: 'https://canpass.me/auth/sign-transaction',
            logger: console,
            store: `localStore`,
          });

          canPass.loginButton();
        }
      })();
    </script>
  </body>
</html>

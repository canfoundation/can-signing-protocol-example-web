!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self)["can-pass-api"]={})}(this,function(t){"use strict";function d(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function p(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),e.push.apply(e,o)}return e}function f(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,n){var e,o,r,i,a=n.broadcast,c=n.addAuths,s={transaction:t,trxOpt:{broadcast:a,expireSeconds:30}};if(!a&&c){s.addAuths=c;var u=t.actions.map(function(t){return function(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?p(Object(e),!0).forEach(function(t){d(n,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):p(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}({},t,{authorization:[].concat(f(t.authorization),[{actor:c[0].actor,permission:"active"}])})});s.transaction.actions=u}return(e={query:"\n    mutation signTransactionRequest($input: RequestSignTransactionInput!)  {\n      requestSignTransaction(input: $input) {\n        requestId\n      }\n    }\n  ",variables:{input:s}},o=w("accessToken"),r=w("endPoint")||"https://prod.api.cryptobadge.app/can-keys/graphql",i={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({query:e.query,variables:e.variables})},v(r,i).then(function(t){return t.json()}).then(function(t){if(t.errors)throw t.errors;return t.data}).catch(function(t){throw t})).then(function(t){return t.requestSignTransaction}).catch(function(t){throw t})}var n,e,r="undefined"!=typeof window?window:{},i={get:function(t){return r.localStorage.getItem(t)},set:function(t,n){return r.localStorage.setItem(t,n)},remove:function(t){r.localStorage.removeItem(t)}},a={},c={get:function(t){return a[t]},set:function(t,n){return a[t]=n},remove:function(t){delete a[t]}},s="CanPass.",u="memory",h=(d(n={},"localStorage",i),d(n,u,c),n),l=i,w=function(t){return l.get("".concat(s).concat(t))},g=function(t,n){return l.set("".concat(s).concat(t),n)},b=r.fetch&&r.fetch.bind(r),v=b;function y(){}function m(){return w("signTxURL")||"https://can-pass.canfoundation.io/sign-transaction"}function x(t,n){if("undefined"==typeof window)throw new Error("Not Browser");var e={width:Math.floor(.8*window.outerWidth),height:Math.floor(.5*window.outerHeight),top:0,left:0};e.width<1e3&&(e.width=1e3),e.height<630&&(e.height=630),e.left=Math.floor(window.screenX+(window.outerWidth-e.width)/2),e.top=Math.floor(window.screenY+(window.outerHeight-e.height)/8);var o="toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0,\n    width=".concat(e.width,",height=").concat(e.height,",\n    left=").concat(e.left,",top=").concat(e.top),r=window.open(n||m(),"producthuntPopup",o);if(!t){var i=(new Date*Math.random()).toString(36).substring(0,8);window[j]=i,window[i]=r}return r}function O(t){var n=t.toString(),e=-1!==n.indexOf("?")?"&":"?";n="".concat(n).concat(e);var o,r=window[window[j]];function i(t){window[c](u,t,!1),r&&(r.close(),delete window[window[j]]),o&&o.close()}r?r.location.href=n:o=x(!0,n);var a=window.addEventListener?"addEventListener":"attachEvent",c=window.removeEventListener?"removeEventListener":"detachEvent",s=window[a],u="attachEvent"==a?"onmessage":"message";return new Promise(function(e,o){s(u,function t(n){n.data||(P.debug("window opener return error",n),i(t),o(new Error("No event data"))),n.data.type===S&&(P.debug("window opener return message",n.data),i(t),e(n.data))},!1)})}var P=new Proxy({setLogger:function(t){e=t}},{get:function(t,n){return"setLogger"===n?t[n]:e&&e[n]||y}}),S="sign-transaction",j="currentWindowRef",T=[],E=[];function C(t,n){if(n=n||{},void 0===t)throw new Error("insert-css: You need to provide a CSS string. Usage: insertCss(cssString[, options]).");var e,o,r=!0===n.prepend?"prepend":"append",i=void 0!==n.container?n.container:document.querySelector("head"),a=T.indexOf(i);return-1===a&&(a=T.push(i)-1,E[a]={}),void 0!==E[a]&&void 0!==E[a][r]?e=E[a][r]:(e=E[a][r]=((o=document.createElement("style")).setAttribute("type","text/css"),o),"prepend"==r?i.insertBefore(e,i.childNodes[0]):i.appendChild(e)),65279===t.charCodeAt(0)&&(t=t.substr(1,t.length)),e.styleSheet?e.styleSheet.cssText+=t:e.textContent+=t,e}var I=C,L=C;I.insertCss=L;function q(t,n,e){var o=2<arguments.length&&void 0!==e?e:"";return t.getAttribute(n)||o}function A(t){if("undefined"!=typeof window){I("\n  .can-pass-login-button {\n    border-radius: 5px;\n    background-color: rgb(255, 255, 0);\n    box-sizing: border-box;\n    color: rgb(0, 13, 255);\n    cursor: pointer;\n    font-family: Helvetica, Arial, sans-serif;\n    font-weight: bold;\n    font-size: 14px;\n    padding: 0 10px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    outline: none;\n    border: 0;\n  }\n\n  .can-pass-login-button > img {\n    height: 100%;\n    width: 25px;\n    margin-right: 10px;\n  }\n");for(var n=document.getElementsByClassName("can-pass-login-button")||[],d=t||w("clientId")||"",e=0;e<n.length;e+=1){var o=n[e];o&&function(){var a=q(o,"data-state","true"),c=q(o,"data-domain","https://cryptobadge.app"),t=q(o,"data-text","Sign in with Cryptobadge"),n=+q(o,"data-width","".concat(220,"px")),s=encodeURIComponent(q(o,"data-redirect-uri","")),u="true"===q(o,"open-popup","false");o.style.width="".concat(n<500&&220<n?n:220,"px");var e=document.createElement("img");e.src="https://d1i5zj4k49u5j1.cloudfront.net/2892b68a3d6c71e94499bb027345fe7c.svg",o.appendChild(e),o.innerHTML+="<span>".concat(t,"</span>");o.addEventListener("click",function(){var t,n,e,o,r,i;u?(t="".concat(c,"/oauth2/authorize?response_type=code&client_id=").concat(d,"&scope=email&redirect_uri=").concat(s,"&state=").concat(a),n="Login With CryptoBadge",e=630,o=800,r=window.outerHeight/2+window.screenY-o/2,i=window.outerWidth/2+window.screenX-e/2,window.open(t,n,"width=".concat(e,", height=").concat(o,", top=").concat(r,", left=").concat(i))):window.location.href="".concat(c,"/oauth2/authorize?response_type=code&client_id=").concat(d,"&scope=email&redirect_uri=").concat(s,"&state=").concat(a)})}()}}}var k,z={init:function(t){var n,e;return t.store&&(n=t.store,l=h[n]||h[u]),t.fetch&&(e=t.fetch,b=e),g("clientId",t.clientId),g("version",t.version),g("endPoint",t.endPoint),g("signTxURL",t.signTxURL),P.setLogger(t.logger),t},setCredentials:function(t){return g("accessToken",t.accessToken),g("idToken",t.idToken),t},signTx:function(t,n,e){if(void 0!==e)return o(t,n).then(function(t){var n,e,o=t.requestId;return n=o,(e=new URL(m())).searchParams.append("txId",n),O(e).then(function(t){if(t.type===S){if(t.error)throw new Error(t.error);if(t.requestTxId===n)return t}})}).then(function(t){return e(null,t)}).catch(function(t){return e(t)});var r=this.signTx;return new Promise(function(e,o){r(t,n,function(t,n){t?o(t):e(n)})})},loginButton:function(){A(w("clientId"))},api:function(){return P.debug("calling api method"),0},openPopup:function(){return x}};"undefined"!=typeof window&&(window.CanPass={getInstance:function(){return k=k||z}});var R=x;t.default=z,t.openPopup=R,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=can-pass-api.js.map
